<pre style='background-color:blue;'>
<font color='blue'>
public static void sort(long[] valuesArray, int[] gapsArray) throws SortException {

        if(<font color='#0004ff' weight='0.00462963' id='38'>gapsArray<font color='#0004ff' weight='0.00462963' id='37'></font></font>.<font color='#0004ff' weight='0.00462963' id='39'></font><font color='#0004ff' weight='0.00462963' id='42'>length<font color='#0004ff' weight='0.00462963' id='41'></font></font> == 0<font color='#000eff' weight='0.0138889' id='46'></font>) throw <font color='#002aff' weight='0.0416667' id='62'>new <font color='#0015ff' weight='0.0208333' id='61'><font color='#000aff' weight='0.0104167' id='54'>EmptyArrayException<font color='#000aff' weight='0.0104167' id='53'></font></font>("Gaps array can not by empty")</font>;</font>

        <font color='#001cff' weight='0.0277778' id='70'><font color='#001cff' weight='0.0277778' id='69'>int<font color='#001cff' weight='0.0277778' id='68'></font></font> </font><font color='#001cff' weight='0.0277778' id='72'>endGap </font><font color='#001cff' weight='0.0277778' id='91'>= <font color='#001cff' weight='0.0277778' id='90'><font color='#001cff' weight='0.0277778' id='89'>gapsArray[gapsArray.length-1]</font></font></font>;
        if(endGap<font color='#000eff' weight='0.0138889' id='95'></font> != 1) <font color='#0054ff' weight='0.0833333' id='117'>throw <font color='#0015ff' weight='0.0208333' id='105'>new </font><font color='#0015ff' weight='0.0208333' id='114'><font color='#000aff' weight='0.0104167' id='107'>InvalidGapSequenceException<font color='#000aff' weight='0.0104167' id='106'></font></font>(<font color='#0005ff' weight='0.00520833' id='110'>"Gaps sequence must end with 1"</font>)<font color='#0005ff' weight='0.00520833' id='112'></font></font>;</font>


        <font color='#0054ff' weight='0.0833333' id='135'><font color='#001cff' weight='0.0277778' id='123'>int </font><font color='#001cff' weight='0.0277778' id='125'>valuesArraySize<font color='#001cff' weight='0.0277778' id='124'></font> </font>= <font color='#001cff' weight='0.0277778' id='133'><font color='#001cff' weight='0.0277778' id='132'><font color='#0009ff' weight='0.00925926' id='127'>valuesArray</font>.length</font></font>;</font>

        for (<font color='#002aff' weight='0.0416667' id='148'><font color='#002aff' weight='0.0416667' id='147'><font color='#000eff' weight='0.0138889' id='140'>int </font><font color='#000eff' weight='0.0138889' id='142'>gap </font><font color='#000eff' weight='0.0138889' id='146'>: <font color='#000eff' weight='0.0138889' id='145'>gapsArray<font color='#000eff' weight='0.0138889' id='143'></font></font></font></font>)</font> {

            for <font color='#0015ff' weight='0.0208333' id='179'>(int i = gap<font color='#0000ff' weight='0.000868056' id='156'></font>; <font color='#0005ff' weight='0.00520833' id='171'><font color='#0002ff' weight='0.00260417' id='169'>i <font color='#0000ff' weight='0.000868056' id='166'>&lt;<font color='#0000ff' weight='0.000868056' id='165'></font> </font><font color='#0000ff' weight='0.000868056' id='168'>valuesArraySize<font color='#0000ff' weight='0.000868056' id='167'></font></font>;</font><font color='#0002ff' weight='0.00260417' id='170'></font> </font>i<font color='#0002ff' weight='0.00260417' id='172'></font>++) </font>{

                long value = valuesArray[i];
                <font color='#0004ff' weight='0.00416667' id='209'>int j = i;

                </font>while <font color='#0002ff' weight='0.00208333' id='236'>(<font color='#0000ff' weight='0.00014881' id='211'>j<font color='#0000ff' weight='0.00014881' id='210'></font> </font>&gt;= gap &amp;&amp; valuesArray[j - gap] &gt; value)<font color='#0001ff' weight='0.00104167' id='235'></font> </font><font color='#0002ff' weight='0.00208333' id='272'>{
                    valuesArray[j] =<font color='#0000ff' weight='0.000115741' id='245'></font> valuesArray[j - gap];
                    <font color='#0000ff' weight='0.000694444' id='270'>j -= gap;
                }</font><font color='#0000ff' weight='0.000694444' id='271'></font></font>

                <font color='#0000ff' weight='0.000694444' id='281'>valuesArray[j] </font>= value;
            }
        }
    }</font>
</pre>
<pre style='background-color:blue;'>
<font color='blue'>
  private static void merge(Comparable[] a, Comparable[] aux, int lo, int mid, int hi) {

        
        assert isSorted(a, lo, mid);
        assert isSorted(a, mid+1, hi);

        
        for (int k = lo; k &lt;= hi; k++) {
            aux[k] = a[k]; 
        }

        
        int i = lo, j = mid+1;
        for (int k = lo; k &lt;= hi; k++) {
            if      (i &gt; mid)              a[k] = aux[j++];   
            else if (j &gt; hi)               a[k] = aux[i++];
            else if (<font color='#ff0000' weight='1' id='298'><font color='#ff0000' weight='1' id='297'><font color='#00ff00' weight='0.5' id='274'>less</font><font color='#00ff00' weight='0.5' id='296'>(<font color='#00aaff' weight='0.166667' id='284'><font color='#00aaff' weight='0.166667' id='283'><font color='#00aaff' weight='0.166667' id='282'><font color='#0054ff' weight='0.0833333' id='276'>aux<font color='#0054ff' weight='0.0833333' id='275'></font></font><font color='#0054ff' weight='0.0833333' id='281'>[<font color='#002aff' weight='0.0416667' id='279'><font color='#002aff' weight='0.0416667' id='278'>j<font color='#002aff' weight='0.0416667' id='277'></font></font>]</font><font color='#002aff' weight='0.0416667' id='280'></font></font></font></font>, </font><font color='#00aaff' weight='0.166667' id='294'><font color='#00aaff' weight='0.166667' id='293'><font color='#00aaff' weight='0.166667' id='292'><font color='#0054ff' weight='0.0833333' id='286'>aux<font color='#0054ff' weight='0.0833333' id='285'></font></font><font color='#0054ff' weight='0.0833333' id='291'>[<font color='#002aff' weight='0.0416667' id='289'><font color='#002aff' weight='0.0416667' id='288'>i<font color='#002aff' weight='0.0416667' id='287'></font></font>]</font><font color='#002aff' weight='0.0416667' id='290'></font></font></font></font>)</font><font color='#00aaff' weight='0.166667' id='295'></font></font></font>)</font> a[k] = aux[j++];
            else                           a[k] = aux[i++];
        }

        
        assert isSorted(a, lo, hi);
    }

    
    private static void sort(Comparable[] a, Comparable[] aux, int lo, int hi) {
        if (hi &lt;= lo) return;
        int mid = lo + (hi - lo) / 2;
        sort(a, aux, lo, mid);
        sort(a, aux, mid + 1, hi);
        merge(a, aux, lo, mid, hi);
    }

    
    public static void sort(Comparable[] a) {
        Comparable[] aux = new Comparable[a.length];
        sort(a, aux, 0, a.length-1);
        assert isSorted(a);
    }
</font>
</pre>
